name: mini-runrun-gitops-ci

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install Helm
        uses: azure/setup-helm@v4
        with:
          version: v3.15.4

      - name: Lint Helm chart
        run: |
          if [ -d "helm-chart" ]; then
            helm lint helm-chart
          else
            echo "No helm-chart directory"
          fi

      - name: Render Helm templates
        run: |
          if [ -d "helm-chart" ]; then
            helm template mini-runrun helm-chart --namespace devsecops-demo > rendered.yaml
            echo "Helm rendered successfully:"
            head -n 30 rendered.yaml || true
          else
            echo "No helm-chart directory"
          fi
